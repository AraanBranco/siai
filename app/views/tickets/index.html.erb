<div class="columns">
  <div class="column">
    <%= link_to new_ticket_path, class: "button is-success in-mobile-expand" do %>
      <span class="icon">
        <i class="ion-plus-round"></i>
      </span>
      <span>Novo Ticket</span>
    <% end %>
  </div>

  <div class="column">
    <%= form_tag(tickets_path, :method => "get", id: "search") do %>
      <p class="control has-addons is-pulled-right">
        <%= text_field_tag :search, params[:search], class: "input", placeholder: "Buscar" %>
        <%= button_tag(type: "submit", class: "button is-success", name: nil) do %>
          Buscar
        <% end %>
      </p>
    <% end %>
  </div>
</div>

<table class="table is-striped">
  <thead>
  <tr>
    <th>ID</th>
    <th>Serto</th>
    <th class="is-hidden-mobile">Assunto</th>
    <th class="is-hidden-mobile">Local</th>
    <th class="is-hidden-mobile">status</th>
    <th></th>
  </tr>
  </thead>
  <tbody>
  <% @tickets.each do |ticket| %>
    <tr>
      <td><%= ticket.id %></td>
      <td><%= ticket.by_sector %></td>
      <td class="is-hidden-mobile"><%= ticket.subject %></td>
      <td class="is-hidden-mobile"><%= ticket.local.to_s.upcase %></td>
      <td class="is-hidden-mobile"><%= ticket.status %></td>
      <td class="has-text-right">
        <% if current_user.it_is_part_of_the_sector?('serti') %>
          <%= link_to ticket_tickets_answers_path(ticket), class: 'button is-info', disabled: ticket.close? do %>
            <span class="icon">
              <i class="ion-edit"></i>
            </span>
              <span class="is-hidden-mobile">Responder</span>
          <% end %>
        <% elsif ticket.answers.present? %>
            <%= link_to ticket_tickets_answers_path(ticket), class: 'button is-info', disabled: ticket.close? do %>
            <span class="icon">
              <i class="ion-eye"></i>
            </span>
                <span class="is-hidden-mobile">Visualizar Resposta</span>
            <% end %>
        <% end %>


        <%= link_to edit_ticket_path(ticket), class: 'button is-success', disabled: ticket.close? do %>
          <span class="icon">
            <i class="ion-edit"></i>
          </span>
          <span class="is-hidden-mobile">Editar</span>
        <% end %>

        <% if current_user.it_is_part_of_the_sector?('serti') %>
          <%= link_to ticket_path(ticket), method: :delete, data: { confirm: 'Tem certeza?' }, class: 'button is-danger' do %>
            <span class="icon">
              <i class="ion-close"></i>
            </span>
            <span class="is-hidden-mobile">Excluir</span>
          <% end %>
        <% end %>
      </td>
    </tr>
  <% end %>
  </tbody>
</table>

<%= paginate @tickets %>
